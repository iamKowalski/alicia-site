<!DOCTYPE html>
<html lang="en">

<%- include('../header/header.ejs') %>

<body class="">
    <div class="wrapper">
        <div class="sidebar">
            <div class="sidebar-wrapper">
                <ul class="nav">
                    <li>
                        <a href="/">
                            <i class="tim-icons icon-align-center"></i>
                            <p>Início</p>
                        </a>
                    </li>
                    <% if (logged) { %>
                    <li>
                        <a href="/profile">
                            <i class="tim-icons icon-single-02"></i>
                            <p>Meu Perfil</p>
                        </a>
                    </li>
                    <li>
                        <a href="/find">
                            <i class="tim-icons icon-zoom-split"></i>
                            <p>Procurar usuário</p>
                        </a>
                    </li>
                    <li class="active">
                        <a href="/guilds" class="active">
                            <i class="tim-icons icon-link-72"></i>
                            <p>Servidores<p>
                        </a>
                    </li>
                    <% } else { %>
                    <% } %>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <%- include('../partials/navbar.ejs') %>
            <div class="content">
                <div class="row">
                  <div class="col-md-8">
                    <div class="card">
                      <div class="card-header">
                        <h5 class="title">
                          Editar configuraçães
                        </h5>
                      </div>
                      <div class="card-body">
                          <div class="row">
                            <div class="col-md-5 pr-md-1">
                              <div class="form-group">
                                <label>Prefixo</label>
                                <input type="text" class="form-control" placeholder="<%- db_guild.prefix %>" value="<%- db_guild.prefix %>" id="prefixo" >
                                <input type="text" class="form-control" placeholder="<%- guild.id %>" value="<%- guild.id %>" id="id" style="display: none;" >
                              </div>
                            </div>
                          </div>
                      </div>
                      <div class="card-footer">
                        <button type="submit" class="btn btn-fill btn-primary" id="save" >
                          Salvar                              
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="card card-user">
                      <div clas="card-body">
                        <p class="card-text">
                          <div class="author">
                            <div class="block block-one"></div>
                            <div class="block block-two"></div>
                            <div class="block block-three"></div>
                            <div class="block block-four"></div>
                            <a>
                              <img class="avatar" src="<%- guild.iconURL %>" alt="<%- guild.name %>">
                              <h5 class="title">
                                <%- guild.name.replace('<', '≺').replace('>', '≻') %>
                              </h5>
                            </a>
                          </div>
                        </p>
                    </div>
                  </div>
                </div>
            </div>
        </div>
    </div>
    <script src="/assets/js/core/jquery.min.js"></script>
    <script src="/assets/js/core/popper.min.js"></script>
    <script src="/assets/js/core/bootstrap.min.js"></script>
    <script src="/assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
    <script src="/assets/js/plugins/chartjs.min.js"></script>
    <script src="/assets/js/plugins/bootstrap-notify.js"></script>
    <script src="/assets/js/black-dashboard.min.js?v=1.0.0"></script>
    <script>
        let redirect = () => window.location.href = 'false' == "false" ? `https://discordapp.com/api/oauth2/authorize?client_id=554402289259905037&redirect_uri=https://alicinha.glitch.me/api/login&response_type=code&scope=identify%20guilds` : "/api/logout"
        $('#save').on('click', function() {
          if ($('#prefixo').val() === "") return
          console.log($('#id').val())
          $.ajax({
            method: "POST",
            url: "/api/guild/save",
            data: {
              id: $('#id').val(),
              prefixo: $('#prefixo').val() 
            }
          }).fail(function () {
            $.notify({ icon: "tim-icons icon-bell-55", message: `Falha ao salvar as configurações do servidor!`}, { type: "danger" })
          }).done(function(req) {
            if (!req) return
            if (req === "Invalid") return redirect()
            if (req === "Done") return $.notify({ icon: "tim-icons icon-bell-55", message: `As configurações do servidor foram salvas com sucesso!`}, { type: "success" })
          })
        })
    </script>
</body>

</html>